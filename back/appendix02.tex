% !TeX root = ../main.tex

\appendix{B}{Preliminary of DiD Estimator}\label{sec:appendix_preliminary_did}
In this section, we introduce the concept of potential outcome framework and the average treatment effect on the treated (ATT) to formalize our research question.
As a straightforward and ideal definition, ATT provides clear guidance on what should be estimated, and it could be obtained through the DiD design.
We will elaborate on what specific estimation approach we adopt and the corresponding motivations in this section.
Moreover, the estimation approach comes with various possible setups, and we explain which are the most suitable for us.

% \textbf{Q: What empirical strategy do you use? Why do you use it?}

As we are interested in the effects of residential shifts and smartphone adoption on human mobility patterns and mobile communication behaviors, we formalize our research questions as follows: what are the magnitudes of differences in mobility and communication behaviors for individuals who receive these treatments compared to a counterfactual scenario where they never experienced them?
The magnitudes of differences are so-called treatment effects, and treatments in this study are either residential shifts or smartphone adoption events. Given that many individuals in our sample receive the treatment, it is natural to focus on average treatment effects rather than individual-level effects.
Moreover, since our primary interest lies in understanding how these life events specifically impact those who experience them---addressing the counterfactual question "what would have happened if they had not been treated?"---we focus on the treatment effects on the treated specifically as our primary causal parameter of interest.

ATT can be formalized as follows. Suppose a treatment occurs in period $t$. ATT is given by:
\[
ATT = \mathbb{E}[Y_{i, t} - Y_{i, t}(\infty) | D_i = 1]
\]
where \( D_i \) is a binary variable indicating whether an individual \( i \) is treated, $Y_{i, t}$ is the observed outcome in period $t$, and $Y_{i, t}(\infty)$ is the counterfactual untreated outcome. Examining how ATT evolves over time provides an additional dimension for analysis, and given these motivations, DiD with the design of multiple periods (also known as the event study) is an ideal econometric approach.

% \textbf{For some of those who are not familiar with DiD, give a brief introduction}

The intuition of DiD is that simply comparing treated and untreated units at a single point in time may be misleading because these groups might differ in unobservable ways. Similarly, comparing the same units before and after treatment might confound the treatment effect with general time trends that would have occurred regardless of treatment.
DiD solves this problem by using a "double comparison." Suppose the treatment occurs in time period \( t \), and first, it compares the change in outcomes for the treated group over time:
\[
\mathbb{E}[Y_{i, t} - Y_{i, t-1} \mid D_i = 1]
\]
Second, it compares this change to the change observed in a control group over the same period:
\[
\mathbb{E}[Y_{i, t} - Y_{i, t-1} \mid D_i = 1]
-
\mathbb{E}[Y_{i, t} - Y_{i, t-1} \mid D_i = 0]
\]
Besides, what makes the DiD design prevalent in empirical study is that it has good theoretical implication in that if we assume parallel trends in counterfactual untreated outcomes:
\[
\mathbb{E}[Y_{i, t}(\infty) - Y_{i, t-1}(\infty) \mid D_i = 1]
-
\mathbb{E}[Y_{i, t}(\infty) - Y_{i, t-1}(\infty) \mid D_i = 0],
\]
then the double comparison can recover ATT:
\begin{align*}
&\underbrace{
    \mathbb{E}[Y_{i, t} - Y_{i, t}(\infty) | D_i = 1]
}_{
    ATT
}
\\
&
=
\mathbb{E}[
    Y_{i, t}
    \mid D_i = 1
]
\\
&\quad\quad
-
\underbrace{
    (
    \mathbb{E}[Y_{i, t-1}(\infty) \mid D_i = 1]
    +
    \mathbb{E}[Y_{i, t}(\infty)
        - Y_{i, t-1}(\infty) \mid D_i = 1]
    )
}_{
    =\mathbb{E}[Y_{i, t}(\infty) \mid D_i = 1]
}
\\
&=
\mathbb{E}[Y_{i, t} - Y_{i, t-1}(\infty) \mid D_i = 1]
-
\underbrace{\mathbb{E}[Y_{i, t}(\infty) - Y_{i, t-1}(\infty) \mid D_i = 0]}_{\text{due to parallel trends}}
\\
&=
\mathbb{E}[Y_{i, t} - Y_{i, t-1} \mid D_i = 1]
-
\mathbb{E}[Y_{i, t} - Y_{i, t-1} \mid D_i = 0].
\end{align*}
Note that observed outcomes are equivalent to counterfactual untreated outcomes for all untreated units in both period $t-1$ and $t$, and the equivalence also holds for treated units at period $t-1$.
